syntax = "proto3";

option go_package = "github.com/ag-computational-bio/BioDataDBModels/go/loadmodels";

import "proto/DatasetModels.proto";
import "google/protobuf/timestamp.proto";
import "protoc/gateway/options/annotations.proto";

// These messages are used in the Load service (user facing)

message LoadSequence {
    option (grpc.gateway.protoc_gen_swagger.options.openapiv2_schema) = {
        json_schema: {
            title: "LoadSequence";
            description: "Database entry for a load sequence"
        };
    };
    string ID = 1;
    LoadSequenceMetadata Metadata = 2;
}

message LoadSequenceMetadata {
    option (grpc.gateway.protoc_gen_swagger.options.openapiv2_schema) = {
        json_schema: {
            title: "LoadSequenceMetadata";
            description: "Metadata for a load sequence"
        };
    };
    string DatasetID = 1;
    string DatasetVersionID = 2;
    string Status = 3;
    string Error = 4;
    google.protobuf.Timestamp Started = 5; // When the datasets was initiated
    google.protobuf.Timestamp Finished = 6; // Last change TODO: need to rename
}

message UploadLinks {
    option (grpc.gateway.protoc_gen_swagger.options.openapiv2_schema) = {
        json_schema: {
            title: "UploadLinks";
            description: "A set of presigned put URL to store the data"
        };
    };
    repeated UploadLink Links = 1; // List of Links to upload a dataset
}

message UploadLink {
    option (grpc.gateway.protoc_gen_swagger.options.openapiv2_schema) = {
        json_schema: {
            title: "UploadLink";
            description: "A presigned URL link and its upload request URL"
        };
    };
    string ID = 1; // ID of the upload request
    string Link = 2; // Upload link (normally a presigned put URL for S3)
}

message CreateLoadLinkSetRequest {
    option (grpc.gateway.protoc_gen_swagger.options.openapiv2_schema) = {
        json_schema: {
            title: "CreateLoadLinkSetRequest";
            description: "Request message to request a set of presigned URL links"
        };
    };
    string DatasetID = 1; // ID of the dataset upload links should be created for
    string DatasetVersionID = 2;
    repeated DatasetObjectMetaData Metadata = 3; // List of metadata of uploaded objects
}